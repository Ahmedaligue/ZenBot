import*as a from'@whiskeysockets/baileys';import b from'chalk';import c from'readline';import d from'fs';import e from'path';import{Boom as f}from'@hapi/boom';import g from'pino';import{handler as h,loadPlugins as i}from'./lib/handler.js';const{makeWASocket:j,useMultiFileAuthState:k,DisconnectReason:l}=a,m=g({level:'silent'}),n='session',o={phNumber2:()=>'\x49\x6e\x67\x72\x65\x73\x61\x20\x74\x75\x20\x6e\x75\x6d\x65\x72\x6f\x20\x63\x6f\x6e\x20\x63\xF3\x64\x69\x67\x6f\x20\x64\x65\x20\x70\x61\xED\x73\x20\x28\x65\x6a\x3A\x20\x2b\x35\x34\x39\x31\x31\x78\x78\x78\x78\x78\x78\x29\x3a\x20',pairingCode:'\x43\xF3\x64\x69\x67\x6f\x20\x64\x65\x20\x65\x6d\x70\x61\x72\x65\x6a\x61\x6d\x69\x65\x6e\x74\x6f\x20\x67\x65\x6e\x65\x72\x61\x64\x6f\x3a'},p=c.createInterface({input:process.stdin,output:process.stdout}),q=r=>new Promise(s=>p.question(r,s));async function r(s){return/^\+?\d{10,15}$/.test(s)}async function t(){const{state:u,saveCreds:v}=await k(n),w=j({auth:u,printQRInTerminal:!1,logger:m});w.ev.on('creds.update',v);if(!d.existsSync(e.join(n,'creds.json'))&&!w.authState.creds.registered){let x='';let y;do{x=await q(b.bgBlack(b.bold.greenBright(o.phNumber2()))),x=x.replace(/\D/g,''),x.startsWith('+')||(x=`+${x}`)}while(!await r(x));y=x.replace(/\D/g,'');try{let z=await w.requestPairingCode(y);z=z?.match(/.{1,4}/g)?.join("-")||z,console.log(b.bold.white(b.bgMagenta(o.pairingCode)),b.bold.white(z))}catch(A){console.log(b.redBright('\x45\x72\x72\x6f\x72\x20\x61\x6c\x20\x67\x65\x6e\x65\x72\x61\x72\x20\x65\x6c\x20\x63\xF3\x64\x69\x67\x6f\x20\x64\x65\x20\x65\x6d\x70\x61\x72\x65\x6a\x61\x6d\x69\x65\x6e\x74\x6f\x3a'),A.message||A)}}w.ev.on('connection.update',B=>{const{connection:C,lastDisconnect:D}=B;if(C==='close'){const E=D?.error instanceof f&&D.error.output.statusCode!==l.loggedOut;console.log(b.red('\x43\x6f\x6e\x65\x78\x69\xF3\x6e\x20\x63\x65\x72\x72\x61\x64\x61\x2e\x20\x52\x65\x69\x6e\x74\x65\x6e\x74\x61\x6e\x64\x6f\x2e\x2e\x2e'),E),E&&t()}else C==='open'&&console.log(b.green('\x42\x6f\x74\x20\x63\x6f\x6e\x65\x63\x74\x61\x64\x6f\x20\x63\x6f\x6e\x20\xE9\x78\x69\x74\x6f\x2e'))}),w.ev.on('messages.upsert',async({messages:F})=>{const G=F[0];if(!G.message||G.key?.remoteJid==='status@broadcast')return;await h(G,w)}),await i()}t();